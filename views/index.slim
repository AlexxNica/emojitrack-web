section#rankings
  ul#data
  br style="clear:both"

div#detailview.modal.hide.fade tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
  div.modal-header
    button.close type="button" data-dismiss="modal" aria-hidden="true" title="close" &times;
    a#openbtn.close title="open in new tab"
      i.icon-external-link.fake-close
    h3.emojifont-restricted EMOJI NAME
    dl
      dt unified id
      dd#uid
        tt sdf
      dt shorthand
      dd#shorthand
        code ?
      dt popularity
      dd#rank.badge.badge-info #-
  div.modal-body
    h4
      | live tweets&nbsp;
      i.icon-refresh.icon-spin title="tweets are streaming live from twitter, no need to refresh"
    ul#tweet_list.icons-ul
  div.modal-footer
    span#tweetbtn
    a#jsonbtn.btn.btn-mini href="#" target="new"
      li.icon-code &nbsp;get details as json

coffee:
  @popDetails = (char_id) ->
    $.get("/api/details/#{char_id}", (response) ->
      #populate details for template
      $('#detailview h3').html "#{emoji.replace_unified(response.char)} #{response.char_details.name}"
      $('#detailview #uid tt').text response.char_details.unified
      $('#detailview #shorthand code').text ":#{response.char_details.short_name}:"
      $('#detailview #rank').text "\##{response.popularity_rank}"
      $('#detailview #openbtn').prop 'href', "/details/#{char_id}"
      $('#detailview #jsonbtn').prop 'href', "/api/details/#{char_id}"

      #construct permalink url
      permalink = document.URL + "details/#{char_id}"

      tweetbutton = $('<a></a>')
      tweetbutton.attr 'data-url', permalink
      tweetbutton.attr 'data-text', "#{response.char_details.name} #{response.char}, ranked \##{response.popularity_rank} out of 841"
      tweetbutton.attr 'data-hashtags', 'emojitracker'
      tweetbutton.attr 'data-dnt', 'true'
      tweetbutton.addClass 'twitter-share-button'

      $('.modal-footer iframe').remove() #remove previous tweetbtn generated iframe, if present
      tweetbutton.insertAfter('#tweetbtn')
      twttr.widgets.load() #force widget to reload

      #populate the list of historic  tweets
      emptyTweetList()
      for tweet in response.recent_tweets
        appendTweetList tweet
      
      #popup the modal
      $('#detailview').modal({ keyboard: true })

    , "json")
    startDetailStreaming(char_id)

  $ ->
    refreshUIFromServer ->
      console.log "UI refreshed"

      # show tooltip
      # disable for now, too many thingies and degrades performance!
      #$('.emoji_char').tooltip({'placement':'top', 'trigger':'hover'})

      # intercept clicks for popup modal instead
      $('.emoji_char').parent('a').click (event) ->
        event.preventDefault()
        clicked_id = $(this).data('id')
        popDetails(clicked_id)

      #configure the details popup modal
      $('#detailview').on 'hide', ->
        stopDetailStreaming()

      #iOS = false
      #p = navigator.platform
      #iOS = true if( p == 'iPad' || p == 'iPhone' || p == 'iPod' )

      startScoreStreaming() #unless iOS
